<!DOCTYPE html>
<html lang="ja">

<head>
    <title>アドすたっと</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
    <script src="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src='//cdn.ractivejs.org/latest/ractive.min.js'></script>
    <script src='//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js'></script>

</head>

<body>
    <div id='container'></div>
    <script id='template' type='text/ractive'>
        {{#themes}}
        <h2>{{title}}</h2>
        <div class="ct-chart id-{{id}}"></div>
        {{/themes}}
    </script>
    <script>
        $(function()
        {
            $.getJSON("results.json", function(json)
            {
                var themes = _.map(json, function(theme,
                    index, list)
                {
                    var hatebuCounts = _.map(theme[
                        'entries'], function(
                        entry, index, list)
                    {
                        return entry['count']
                    })
                    return {
                        id: index,
                        title: theme['themeTitle'],
                        chartData:
                        {
                            labels: [1, 2, 3, 4, 5, 6,
                                7, 8, 9,
                                10, 11, 12, 13,
                                14, 15, 16,
                                17, 18, 19, 20,
                                21, 22, 23,
                                24, 25
                            ],
                            series: [
                                hatebuCounts
                            ]
                        }
                    };
                });

                console.log(json);
                console.log(themes);

                // レンダリング
                var ractive = new Ractive(
                {
                    el: 'container',
                    template: '#template',
                    data:
                    {
                        themes: themes
                    }
                });

                // グラフの表示
                var option = {
                    low: 0,
                    showArea: true
                };
                for (var i = 0; i < json.length; i++)
                {
                    new Chartist.Line('.ct-chart.id-' +
                        themes[i]['id'], themes[i][
                            'chartData'
                        ], option);
                }

            });
        });
    </script>
</body>

</html>
